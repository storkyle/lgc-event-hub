# Development Dockerfile with hot reload support
FROM node:20.19.5-slim

WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@8.15.0 --activate

# Copy package files
COPY package.json pnpm-lock.yaml ./

# Install ALL dependencies (including dev dependencies for ts-node and nodemon)
RUN pnpm install

# Copy tsconfig for TypeScript compilation
COPY tsconfig.json ./

# Copy schema for initialization
COPY schema.sql ./

# Source code will be mounted as a volume, so no need to copy here
# This allows hot reload to work

# Set non-root user
USER node

# Default command (can be overridden in docker-compose)
CMD ["pnpm", "run", "dev:api:watch"]
